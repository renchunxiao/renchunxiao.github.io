<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Java，JVM，Redis，Hbase，分布式，Mongo"><title>分布式系统入门1 | 任春晓的博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">分布式系统入门1</h1><a id="logo" href="/.">任春晓的博客</a><p class="description">学而不思则罔，思而不学则殆</p></div><div id="nav-menu"><a href="/"><i class="fa fa-home"> 首页</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">分布式系统入门1</h1><div class="post-meta">Jun 2, 2018<span> | </span><span class="category"><a href="/categories/分布式架构/">分布式架构</a></span></div><div class="post-content"><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>分布式系统是一个硬件或软件组件分布在不同的网络计算机上，彼此之间通过网络消息传递进行通信和协调的系统。</p>
<p>一个标准的分布式系统都会有如下几个特征：</p>
<ul>
<li>分布性，分布式系统中的多台计算机在空间上随意分布，同时，机器的分布情况也会随时变动。</li>
<li>对等性，分布式系统中的计算机没有主/从之分。(个人理解对等下性是相对于 client 来说的，client 在请求一个服务的时候来看，接受请求的计算机并没有主/从之分)。副本是分布式系统当中对<code>数据</code>和<code>服务</code>冗余的一种方式。为了提高服务可用性，会对数据和服务进行副本处理。<code>数据副本</code>是指在不同的节点上持久化同一份数据，。<code>服务副本</code>是指多个节点提供同样的服务，每个节点都能处理外部的请求。</li>
<li>并发性，分布式系统当中的多个节点会并发操作一些资源，如果准确且高效的协调分布式并发操作也是很大的挑战。</li>
<li>缺乏全局时钟，分布式系统当中很难定义两个事件谁先谁后，原因是因为缺乏一个全局的时钟序列控制。</li>
<li>故障总是发生，组成分布式系统的任何计算机都有可能发生故障。任何在设计阶段考虑到的异常情况，一定会在系统实际运行中发生，并且，在系统实际运行过程中还会遇到很多在设计时未能考虑到的异常。</li>
</ul>
<p>分布式环境的各种问题：</p>
<ul>
<li>通信异常，分布式系统之间的交互必然是通过网络，而网络是一个不可靠的交互方式，会经常出现通信异常的情况。</li>
<li>网络分区，由于网络发生问题，导致分布式系统当中部分节点之间的网络延迟不断增大，最终导致组成分布式的所有节点，只有部分节点之间能够进行正常通信，而另外一些节点则不能，这个情况称为网络分区。</li>
</ul>
<p>分布式系统每一次请求的三态：</p>
<ul>
<li>成功</li>
<li>失败</li>
<li>超时</li>
</ul>
<p>衡量分布式系统的指标：</p>
<ul>
<li>性能</li>
<li>可用性</li>
<li>扩展性</li>
<li>一致性</li>
</ul>
<h1 id="分布式系统原理"><a href="#分布式系统原理" class="headerlink" title="分布式系统原理"></a>分布式系统原理</h1><h2 id="数据分布方式"><a href="#数据分布方式" class="headerlink" title="数据分布方式"></a>数据分布方式</h2><h3 id="哈希方式"><a href="#哈希方式" class="headerlink" title="哈希方式"></a>哈希方式</h3><p>优点是简单，如何哈希的算法比较好数据分布均匀。缺点是扩展性不高，一旦集群扩展，大部分数据都需要重新迁移分布。</p>
<p>哈希算法当中如果某数据特征值的数据不均，容易出现数据倾斜，导致某台服务器数据分布过多，导致性能问题。</p>
<p>哈希扩展性差的问题，可以换个思路来优化下，哈希不再是简单的将哈希值与机器数量做触发取模映射，而是将对应关系作为元数据有专门的元数据服务器管理。访问数据时，先计算哈希值并且查询元数据服务器，获取该哈希值对应的机器。同时哈希值取模个数往往大于机器个数，这样同一台机器上负责多个哈希值。在集群扩容的时候，将部分余数分配给新加入的机器并且迁移对应的数据到新机器上，从而降低扩容成本。</p>
<h3 id="按数据范围分布"><a href="#按数据范围分布" class="headerlink" title="按数据范围分布"></a>按数据范围分布</h3><p>将数据按照特征值的值域范围划分为不同的区间，使得集群中每台服务器处理不同区间的数据。</p>
<p>例如用户 id 的值域范围是 [1, 100)，集群有 3 台服务器，将用户 id 的值域分为三个区间 [1, 33), [33. 90), [90, 100) 分布由 3 台服务器负责处理。</p>
<p>数据区间的数据大小和区间大小是没有关系的。上面例子当中值域的大小不太相同，但是数据的大小实际上比较接近。在工程上，为了数据迁移等负载均衡方便，往往利用动态划分区间技术，使得每个区间中服务的数据尽量一样多。当某个区间的数据量较大时，通过将区间分裂的方式拆分为两个区间，使得每个区间维持在一个固定的阈值下。</p>
<p>要使用专门的服务器在内存中维护数据分布信息， 称这种数据的分布信息为一种元信息。对于大规模的集群，由于元信息的规模非常庞大，单台计算机无法独立维护，需要使用多台机器作为元信息服务器。</p>
<p>实际工程中，一般也不按照某一维度划分数据范围，而是使用全部数据划分范围，从而避免数 据倾斜的问题。</p>
<p>优点是灵活根据数据量具体情况拆分原有数据区间，拆分后的数据区间可以迁移到其他机器。扩容时候非常方便无限制。缺点是需要维护大量复杂的元数据。数据增长很大后，元数据服务器容易称为瓶颈。</p>
<h3 id="按数据量分布"><a href="#按数据量分布" class="headerlink" title="按数据量分布"></a>按数据量分布</h3><p>数据量分布数据与具体的数据特征无关，而是将数据视为一个顺序增长的文件，并将这个文件按照某一较为固定的大小划分为若干数据块(chunk)，不同的数据块分布到不同的服务器上。也需要元数据服务器来管理元数据。</p>
<p>由于与具体数据特征无关，按数据量分布数据的方式一般没有数据倾斜的问题，数据总是被均匀切分并分布到集群中。</p>
<p>优缺点与按数据范围分布类似。</p>
<h3 id="一致性哈希"><a href="#一致性哈希" class="headerlink" title="一致性哈希"></a>一致性哈希</h3><p>使用一致性哈希的方式需要将节点在一致性哈希环上的位置作为元信息加以管理，其元信息的 量通常比按数据范围分布数据和按数据量分布数据的元信息量要小很多。</p>
<h3 id="副本与数据分布"><a href="#副本与数据分布" class="headerlink" title="副本与数据分布"></a>副本与数据分布</h3><p>分布式系统容错、提高可用性的基本手段就是使用副本。对于数据副本的分布方式主要影响系统的可扩展性。</p>
<p>一种基本的数据副本策略是以机器为单位，若干机器互为副本，副本机器之间的数据完全相同。其优点是非常简单，其缺点是恢复数据的效率不高、可扩 展性也不高。</p>
<p>更合适的做法不是以机器作为副本单位，而是将数据拆为较合理的数据段，以数据段为单位作 为副本。实践中，常常使得每个数据段的大小尽量相等且控制在一定的大小以内。</p>
<p>一旦将数据分为数据段，则可以以数据段为单位管理副本，从而副本与机器不再硬相关，每台 机器都可以负责一定数据段的副本。</p>
<p>工程中，完全按照数据段建立副本会引起需要管理的元数据的开销增大，副本维护的难度也相 应增大。一种折中的做法是将某些数据段组成一个数据段分组，按数据段分组为粒度进行副本管理。 这样做可以将副本粒度控制在一个较为合适的范围内。</p>
<p>【参考资料】</p>
<ol>
<li><a href="https://book.douban.com/subject/26292004/" target="_blank" rel="noopener">从Paxos到Zookeeper</a></li>
<li>分布式系统原理介绍</li>
</ol>
<p>—EOF—</p>
</div><div class="tags"><a href="/tags/分布式/">分布式</a></div><div class="post-nav"><a class="next" href="/2018/06/02/思维误区笔记整理/">思维误区笔记整理</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Bootstrap学习/">Bootstrap学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Elasticsearch/">Elasticsearch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java解惑/">Java解惑</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">c</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/cache/">cache</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/eclipse/">eclipse</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/effective-java/">effective-java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/go/">go</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/guava/">guava</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/html/">html</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/j2ee/">j2ee</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java-ognl/">java-ognl</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javaNIO/">javaNIO</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java基础/">java基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jdbc/">jdbc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jms/">jms</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js基础/">js基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/junit/">junit</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/log/">log</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/lua/">lua</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/maven/">maven</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mybatis/">mybatis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/scala/">scala</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tcp-ip/">tcp/ip</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vim/">vim</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/websocket/">websocket</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/代码优化/">代码优化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式架构/">分布式架构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/思维/">思维</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/折腾/">折腾</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库连接池/">数据库连接池</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/">数据结构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/正则表达式/">正则表达式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/理解计算机/">理解计算机</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/程序员修炼/">程序员修炼</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/重构/">重构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/页面设计/">页面设计</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">任春晓的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>