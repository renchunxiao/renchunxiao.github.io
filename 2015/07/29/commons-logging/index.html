<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><title>commons-logging 源码分析 1 - 任春晓的博客</title><meta name="description" content="介绍有关 java 当中的日志介绍，这里不多说，给几个链接：http://blog.csdn.net/yycdaizi/article/details/8276265框架分析使用方式：12345private static Log log = LogFactory.getLog(CommonsLog"><link type="text/css" rel="stylesheet" href="/css/pure.css?v=0.0.1"><link type="text/css" rel="stylesheet" href="/css/style.css?v=0.0.1"><script type="text/javascript" src="//cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script></head></html><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">commons-logging 源码分析 1</h1><a id="logo" href="/.">任春晓的博客</a></div><div id="nav-menu"><div class="bitcron_nav"><div class="site_nav_wrap"><div class="site_nav"><span class="a_container"><a href="/." class="selected active current">首页</a></span><span class="a_container"><a href="/archives/">归档</a></span><span class="a_container"><a href="/about/">关于</a></span><span class="a_container"><a href="/atom.xml">订阅</a></span></div></div></div></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">commons-logging 源码分析 1</h1><div class="post-meta">2015-07-29<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" type="text/javascript"></script><span class="meta-space">  |  </span><span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span><span> 浏览</span></span></div><!--文章内容--><div class="post-content"><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>有关 java 当中的日志介绍，这里不多说，给几个链接：</p>
<p><a href="http://blog.csdn.net/yycdaizi/article/details/8276265" target="_blank" rel="noopener">http://blog.csdn.net/yycdaizi/article/details/8276265</a></p>
<h2 id="框架分析"><a href="#框架分析" class="headerlink" title="框架分析"></a>框架分析</h2><p><img src="https://renchunxiao.com/public/images/commons-logging.png" alt="包结构"></p>
<p>使用方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Log log = LogFactory.getLog(CommonsLog.class);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	log.info(<span class="string">"rcx"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主要看 LogFactory 类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Log <span class="title">getLog</span><span class="params">(Class clazz)</span> <span class="keyword">throws</span> LogConfigurationException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getFactory().getInstance(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LogFactory <span class="title">getFactory</span><span class="params">()</span> <span class="keyword">throws</span> LogConfigurationException </span>&#123;</span><br><span class="line">        ClassLoader contextClassLoader = getContextClassLoaderInternal();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (contextClassLoader == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                logDiagnostic(<span class="string">"Context classloader is null."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果我们不是第一次使用 LogFactory 我们会从当前缓存里面获取 LogFactory 的实例</span></span><br><span class="line">        LogFactory factory = getCachedFactory(contextClassLoader);</span><br><span class="line">        <span class="keyword">if</span> (factory != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> factory;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">            logDiagnostic(</span><br><span class="line">                    <span class="string">"[LOOKUP] LogFactory implementation requested for the first time for context classloader "</span> +</span><br><span class="line">                    objectId(contextClassLoader));</span><br><span class="line">            logHierarchy(<span class="string">"[LOOKUP] "</span>, contextClassLoader);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 commons-logging.properties 里面的配置</span></span><br><span class="line">        Properties props = getConfigurationFile(contextClassLoader, FACTORY_PROPERTIES);</span><br><span class="line"></span><br><span class="line">        ClassLoader baseClassLoader = contextClassLoader;</span><br><span class="line">        <span class="keyword">if</span> (props != <span class="keyword">null</span>) &#123;</span><br><span class="line">            String useTCCLStr = props.getProperty(TCCL_KEY);</span><br><span class="line">            <span class="keyword">if</span> (useTCCLStr != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (Boolean.valueOf(useTCCLStr).booleanValue() == <span class="keyword">false</span>) &#123;</span><br><span class="line">                    baseClassLoader = thisClassLoader;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">            logDiagnostic(<span class="string">"[LOOKUP] Looking for system property ["</span> + FACTORY_PROPERTY +</span><br><span class="line">                          <span class="string">"] to define the LogFactory subclass to use..."</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String factoryClass = getSystemProperty(FACTORY_PROPERTY, <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (factoryClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                    logDiagnostic(<span class="string">"[LOOKUP] Creating an instance of LogFactory class '"</span> + factoryClass +</span><br><span class="line">                                  <span class="string">"' as specified by system property "</span> + FACTORY_PROPERTY);</span><br><span class="line">                &#125;</span><br><span class="line">                factory = newFactory(factoryClass, baseClassLoader, contextClassLoader);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                    logDiagnostic(<span class="string">"[LOOKUP] No system property ["</span> + FACTORY_PROPERTY + <span class="string">"] defined."</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                logDiagnostic(<span class="string">"[LOOKUP] A security exception occurred while trying to create an"</span> +</span><br><span class="line">                              <span class="string">" instance of the custom factory class"</span> + <span class="string">": ["</span> + trim(e.getMessage()) +</span><br><span class="line">                              <span class="string">"]. Trying alternative implementations..."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                logDiagnostic(<span class="string">"[LOOKUP] An exception occurred while trying to create an"</span> +</span><br><span class="line">                              <span class="string">" instance of the custom factory class"</span> + <span class="string">": ["</span> +</span><br><span class="line">                              trim(e.getMessage()) +</span><br><span class="line">                              <span class="string">"] as specified by a system property."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (factory == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                logDiagnostic(<span class="string">"[LOOKUP] Looking for a resource file of name ["</span> + SERVICE_ID +</span><br><span class="line">                              <span class="string">"] to define the LogFactory subclass to use..."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">final</span> InputStream is = getResourceAsStream(contextClassLoader, SERVICE_ID);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>( is != <span class="keyword">null</span> ) &#123;</span><br><span class="line">                    BufferedReader rd;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        rd = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(is, <span class="string">"UTF-8"</span>));</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (java.io.UnsupportedEncodingException e) &#123;</span><br><span class="line">                        rd = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(is));</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    String factoryClassName = rd.readLine();</span><br><span class="line">                    rd.close();</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (factoryClassName != <span class="keyword">null</span> &amp;&amp; ! <span class="string">""</span>.equals(factoryClassName)) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                            logDiagnostic(<span class="string">"[LOOKUP]  Creating an instance of LogFactory class "</span> +</span><br><span class="line">                                          factoryClassName +</span><br><span class="line">                                          <span class="string">" as specified by file '"</span> + SERVICE_ID +</span><br><span class="line">                                          <span class="string">"' which was present in the path of the context classloader."</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        factory = newFactory(factoryClassName, baseClassLoader, contextClassLoader );</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                        logDiagnostic(<span class="string">"[LOOKUP] No resource file with name '"</span> + SERVICE_ID + <span class="string">"' found."</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                    logDiagnostic(</span><br><span class="line">                        <span class="string">"[LOOKUP] A security exception occurred while trying to create an"</span> +</span><br><span class="line">                        <span class="string">" instance of the custom factory class"</span> +</span><br><span class="line">                        <span class="string">": ["</span> + trim(ex.getMessage()) +</span><br><span class="line">                        <span class="string">"]. Trying alternative implementations..."</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (factory == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (props != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                    logDiagnostic(</span><br><span class="line">                        <span class="string">"[LOOKUP] Looking in properties file for entry with key '"</span> + FACTORY_PROPERTY +</span><br><span class="line">                        <span class="string">"' to define the LogFactory subclass to use..."</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                String factoryClass = props.getProperty(FACTORY_PROPERTY);</span><br><span class="line">                <span class="keyword">if</span> (factoryClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                        logDiagnostic(</span><br><span class="line">                            <span class="string">"[LOOKUP] Properties file specifies LogFactory subclass '"</span> + factoryClass + <span class="string">"'"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    factory = newFactory(factoryClass, baseClassLoader, contextClassLoader);</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                        logDiagnostic(<span class="string">"[LOOKUP] Properties file has no entry specifying LogFactory subclass."</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                    logDiagnostic(<span class="string">"[LOOKUP] No properties file available to determine"</span> + <span class="string">" LogFactory subclass from.."</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (factory == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                logDiagnostic(</span><br><span class="line">                    <span class="string">"[LOOKUP] Loading the default LogFactory implementation '"</span> + FACTORY_DEFAULT +</span><br><span class="line">                    <span class="string">"' via the same classloader that loaded this LogFactory"</span> +</span><br><span class="line">                    <span class="string">" class (ie not looking in the context classloader)."</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建 LogFactoryImpl 实例</span></span><br><span class="line">            factory = newFactory(FACTORY_DEFAULT, thisClassLoader, contextClassLoader);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (factory != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 缓存这个 LogFactory</span></span><br><span class="line">            cacheFactory(contextClassLoader, factory);</span><br><span class="line">			<span class="comment">// 把 commons-logging.properties 里面的属性放到 LogFactory 的属性里面</span></span><br><span class="line">            <span class="keyword">if</span> (props != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Enumeration names = props.propertyNames();</span><br><span class="line">                <span class="keyword">while</span> (names.hasMoreElements()) &#123;</span><br><span class="line">                    String name = (String) names.nextElement();</span><br><span class="line">                    String value = props.getProperty(name);</span><br><span class="line">                    factory.setAttribute(name, value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>从上面代码可以看到我们如果没有一些配置的话会获取到一个默认的 LogFactoryImpl 实例。</p>
<p>将上面的 getFactory 方法整理成下面几个步骤</p>
<ul>
<li>获得当前线程的 classloader，命名为 contextClassLoader</li>
<li>根据 contextClassLoader 在缓存中获得 logFactory，这里的缓存使用的是org.apache.commons.logging.impl.WeakHashTable，key 是 classloader，value 是logFactory，如果在缓存中有 logFactory 则直接返回，没有进入下面的流程</li>
<li>读取配置文件 commons-logging.properties</li>
<li>如果读到了配置文件，判断其中 use_tccl 属性，然后设定 baseClassLoader 是使用 contextClassLoader 还是使用加载 本Cla ss文件的那 个classloader（名字为thisClassLoader）</li>
<li>下面生成 logFactory，这里会有使用四种方式，依次来尝试生成。<ul>
<li>通过系统属性中寻找org.apache.commons.logging.LogFactory的value值，根据值为类名生成logFactory</li>
<li>通过资源META-INF/services/org.apache.commons.logging.LogFactory，获得的值为类名生成logFactory</li>
<li>通过刚才读取的配置文件commons-logging.properties，从中获取以org.apache.commons.logging.LogFactory为key的value值，根据值为类名生成logFactory</li>
<li>如果上面都不成功的话，会使用默认的实现类org.apache.commons.logging.impl.LogFactoryImpl来生成logFactory</li>
</ul>
</li>
<li>将生成的 logFactory 缓存起来</li>
<li>返回 logFactory</li>
</ul>
<p>分析：我们使用 Commons Logging 和 log4j 一起使用。</p>
<p>我们需要在 classpath 下添加 commons-logging.properties 文件，并且文件里面只需有一行设置 Log 的实现类，<code>org.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger</code>。</p>
<p>那么我们看下为什么会使用这个类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在 LogFactory 当中 getFactory 方法最后的操作，说明，如果我们添加了这个配置文件，会把属性通过 setAttribute 设置进去。</span></span><br><span class="line">	<span class="keyword">if</span> (props != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Enumeration names = props.propertyNames();</span><br><span class="line">                <span class="keyword">while</span> (names.hasMoreElements()) &#123;</span><br><span class="line">                    String name = (String) names.nextElement();</span><br><span class="line">                    String value = props.getProperty(name);</span><br><span class="line">                    factory.setAttribute(name, value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LogFactoryImpl 当中 setAttribute 的实现，attributes 是个 Hashtable</span></span><br><span class="line"><span class="keyword">protected</span> Hashtable attributes = <span class="keyword">new</span> Hashtable();</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAttribute</span><span class="params">(String name, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (logConstructor != <span class="keyword">null</span>) &#123;</span><br><span class="line">            logDiagnostic(<span class="string">"setAttribute: call too late; configuration already performed."</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">            attributes.remove(name);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            attributes.put(name, value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (name.equals(TCCL_KEY)) &#123;</span><br><span class="line">            useTCCL = value != <span class="keyword">null</span> &amp;&amp; Boolean.valueOf(value.toString()).booleanValue();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继续看 LogFactory 当中 getLog 后半部分是 getInstance</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Log <span class="title">getLog</span><span class="params">(Class clazz)</span> <span class="keyword">throws</span> LogConfigurationException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getFactory().getInstance(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LogFactoryImpl 的 getInstance 实现</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Log <span class="title">getInstance</span><span class="params">(String name)</span> <span class="keyword">throws</span> LogConfigurationException </span>&#123;</span><br><span class="line">        Log instance = (Log) instances.get(name);</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = newInstance(name);</span><br><span class="line">            instances.put(name, instance);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LogFactoryImpl 的 newInstance</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Log <span class="title">newInstance</span><span class="params">(String name)</span> <span class="keyword">throws</span> LogConfigurationException </span>&#123;</span><br><span class="line">        Log instance;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (logConstructor == <span class="keyword">null</span>) &#123;</span><br><span class="line">                instance = discoverLogImplementation(name);<span class="comment">//获取具体 Log 实现</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                Object params[] = &#123; name &#125;;</span><br><span class="line">                instance = (Log) logConstructor.newInstance(params);</span><br><span class="line">            &#125;</span><br><span class="line">          省略......</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LogFactoryImpl 的 discoverLogImplementation</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Log <span class="title">discoverLogImplementation</span><span class="params">(String logCategory)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> LogConfigurationException </span>&#123;</span><br><span class="line">        ......省略</span><br><span class="line"></span><br><span class="line">        String specifiedLogClassName = findUserSpecifiedLogClassName();</span><br><span class="line"> 		......省略</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// LogFactoryImpl 的 findUserSpecifiedLogClassName,这个方法看着很长，其实很简单就是从 hashTable 里面要获取属性，如果指定了就回返回实现类的类全名。</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">findUserSpecifiedLogClassName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">            logDiagnostic(<span class="string">"Trying to get log class from attribute '"</span> + LOG_PROPERTY + <span class="string">"'"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        String specifiedClass = (String) getAttribute(LOG_PROPERTY);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (specifiedClass == <span class="keyword">null</span>) &#123; <span class="comment">// @deprecated</span></span><br><span class="line">            <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                logDiagnostic(<span class="string">"Trying to get log class from attribute '"</span> +</span><br><span class="line">                              LOG_PROPERTY_OLD + <span class="string">"'"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            specifiedClass = (String) getAttribute(LOG_PROPERTY_OLD);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (specifiedClass == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                logDiagnostic(<span class="string">"Trying to get log class from system property '"</span> +</span><br><span class="line">                          LOG_PROPERTY + <span class="string">"'"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                specifiedClass = getSystemProperty(LOG_PROPERTY, <span class="keyword">null</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">                <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                    logDiagnostic(<span class="string">"No access allowed to system property '"</span> +</span><br><span class="line">                        LOG_PROPERTY + <span class="string">"' - "</span> + e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (specifiedClass == <span class="keyword">null</span>) &#123; <span class="comment">// @deprecated</span></span><br><span class="line">            <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                logDiagnostic(<span class="string">"Trying to get log class from system property '"</span> +</span><br><span class="line">                          LOG_PROPERTY_OLD + <span class="string">"'"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                specifiedClass = getSystemProperty(LOG_PROPERTY_OLD, <span class="keyword">null</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SecurityException e) &#123;</span><br><span class="line">                <span class="keyword">if</span> (isDiagnosticsEnabled()) &#123;</span><br><span class="line">                    logDiagnostic(<span class="string">"No access allowed to system property '"</span> +</span><br><span class="line">                        LOG_PROPERTY_OLD + <span class="string">"' - "</span> + e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (specifiedClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">            specifiedClass = specifiedClass.trim();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> specifiedClass;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>上面的过程可以总结成几部：</p>
<ul>
<li>判断 instances.get(name) 获取的 log 是不是为空，为空去 newInstance</li>
<li>newInstance 当中会判断 logConstructor 是不是空，为空 discoverLogImplementation</li>
<li>discoverLogImplementation 会查找是不是自己定义实现的 Log 全路径，如果有就根据这个 class 全路径创建 log，如果没有就按照顺序创建 log 实例，顺序如下：<ul>
<li>org.apache.commons.logging.impl.Log4JLogger</li>
<li>org.apache.commons.logging.impl.Jdk14Logger</li>
<li>org.apache.commons.logging.impl.Jdk13LumberjackLogger</li>
<li>org.apache.commons.logging.impl.SimpleLog</li>
</ul>
</li>
</ul>
<p>总结下就是，commons-logging项目采用了一种动态搜索的机制，在实际运行时，动态的选择log 的实现方式。如果没有log4j，就使用jdk1.4的logging，如果再没有，就使用Lumberjack，它是为jdk1.2与1.3实现了Java日志 API，再没有，那就使用自身提供的一个log（SimpleLog）。</p>
<p>下次会分析这些 Log 的实现方式，以及这个仅有10多个类组成的框架给我们什么样的启发，以及他的优缺点。</p>
<p>—EOF—</p>
</div><!--文章标签--><div class="tags"><a href="/tags/java-log/">java, log</a></div><!--评论--></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" id="search" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://renchunxiao.com"/></form></div><div class="widget"><div class="widget-title"> 分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Bootstrap学习/">Bootstrap学习</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Elasticsearch/">Elasticsearch</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java解惑/">Java解惑</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">c</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/cache/">cache</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/eclipse/">eclipse</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/effective-java/">effective-java</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/go/">go</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/guava/">guava</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html/">html</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/j2ee/">j2ee</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java-ognl/">java-ognl</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javaNIO/">javaNIO</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java基础/">java基础</a><span class="category-list-count">31</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/jdbc/">jdbc</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/jms/">jms</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js基础/">js基础</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/junit/">junit</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/log/">log</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/lua/">lua</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/maven/">maven</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mybatis/">mybatis</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/scala/">scala</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tcp-ip/">tcp/ip</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vim/">vim</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/websocket/">websocket</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/代码优化/">代码优化</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/折腾/">折腾</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库连接池/">数据库连接池</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/">数据结构</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/正则表达式/">正则表达式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/理解计算机/">理解计算机</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/程序员修炼/">程序员修炼</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/重构/">重构</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/页面设计/">页面设计</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"> 标签</div><div class="tagcloud"><a href="/tags/面向对象-设计原则/" style="font-size: 12px;">面向对象 设计原则</a> <a href="/tags/笔记-代码优化/" style="font-size: 13.5px;">笔记 代码优化</a> <a href="/tags/linux/" style="font-size: 12.5px;">linux</a> <a href="/tags/linux-基础-笔记/" style="font-size: 12px;">linux 基础 笔记</a> <a href="/tags/git-学习笔记/" style="font-size: 14px;">git 学习笔记</a> <a href="/tags/j2ee-sevlet/" style="font-size: 12px;">j2ee sevlet</a> <a href="/tags/vim-学习笔记/" style="font-size: 13.5px;">vim 学习笔记</a> <a href="/tags/lua/" style="font-size: 13.5px;">lua</a> <a href="/tags/正则表达式/" style="font-size: 12px;">正则表达式</a> <a href="/tags/笔记-位运算/" style="font-size: 12.5px;">笔记 位运算</a> <a href="/tags/笔记/" style="font-size: 17.5px;">笔记</a> <a href="/tags/笔记-前端/" style="font-size: 12px;">笔记 前端</a> <a href="/tags/笔记-代码优化-程序设计实践笔记/" style="font-size: 12px;">笔记 代码优化 程序设计实践笔记</a> <a href="/tags/html/" style="font-size: 12px;">html</a> <a href="/tags/json-js-jsonp/" style="font-size: 12px;">json js jsonp</a> <a href="/tags/算法/" style="font-size: 12px;">算法</a> <a href="/tags/eclipse/" style="font-size: 12px;">eclipse</a> <a href="/tags/js/" style="font-size: 12px;">js</a> <a href="/tags/笔记-c/" style="font-size: 15px;">笔记 c</a> <a href="/tags/笔记-java/" style="font-size: 18px;">笔记 java</a> <a href="/tags/编码-base64/" style="font-size: 12px;">编码 base64</a> <a href="/tags/redis/" style="font-size: 13.5px;">redis</a> <a href="/tags/j2ee-jdbc/" style="font-size: 13.5px;">j2ee jdbc</a> <a href="/tags/java-ognl/" style="font-size: 12px;">java ognl</a> <a href="/tags/笔记-http/" style="font-size: 12.5px;">笔记 http</a> <a href="/tags/笔记-j2ee/" style="font-size: 12px;">笔记 j2ee</a> <a href="/tags/linux-shell/" style="font-size: 14.5px;">linux shell</a> <a href="/tags/linux-awk/" style="font-size: 12.5px;">linux awk</a> <a href="/tags/linux-sed/" style="font-size: 12.5px;">linux sed</a> <a href="/tags/go-学习笔记/" style="font-size: 13px;">go 学习笔记</a> <a href="/tags/笔记-scala/" style="font-size: 16.5px;">笔记 scala</a> <a href="/tags/mysql/" style="font-size: 12.5px;">mysql</a> <a href="/tags/lua-string/" style="font-size: 12px;">lua, string</a> <a href="/tags/lua-table/" style="font-size: 12px;">lua,table</a> <a href="/tags/java-junit/" style="font-size: 13px;">java, junit</a> <a href="/tags/java-jms/" style="font-size: 12.5px;">java, jms</a> <a href="/tags/java-maven/" style="font-size: 13px;">java, maven</a> <a href="/tags/java-cache/" style="font-size: 15.5px;">java, cache</a> <a href="/tags/java-log/" style="font-size: 12.5px;">java, log</a> <a href="/tags/java/" style="font-size: 16px;">java</a> <a href="/tags/锁/" style="font-size: 12px;">锁</a> <a href="/tags/笔记-java/" style="font-size: 17px;">笔记, java</a> <a href="/tags/lua/" style="font-size: 12px;">lua,</a> <a href="/tags/java-连接池/" style="font-size: 12.5px;">java, 连接池</a> <a href="/tags/笔记-ES/" style="font-size: 14.5px;">笔记, ES</a> <a href="/tags/笔记-Android/" style="font-size: 12.5px;">笔记, Android</a> <a href="/tags/笔记，docker/" style="font-size: 12px;">笔记，docker</a> <a href="/tags/笔记-mybatis/" style="font-size: 16px;">笔记, mybatis</a> <a href="/tags/笔记，redis/" style="font-size: 12px;">笔记，redis</a> <a href="/tags/笔记-websocket/" style="font-size: 12px;">笔记, websocket</a> <a href="/tags/笔记-tcp-ip协议/" style="font-size: 13px;">笔记, tcp/ip协议</a> <a href="/tags/笔记-数据结构/" style="font-size: 12.5px;">笔记, 数据结构</a></div></div><div class="widget"><div class="widget-title"> 最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/11/11/timestamp/">深入理解程序中的时间属性</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/08/cms-gc/">深入学习 CMS GC</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/09/linkedlist-algorithm1/">LinkedList 简单算法题解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/28/java-thread-safe/">java 线程安全性</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/21/java-stack/">java 实现 stack</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/09/javaio-tips/">Java IO 概念理清</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/09/java-list-iterator/">jdk 中的 List 的迭代方式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/16/tree-inTraverse/">二叉树的中序遍历</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/15/tree-PreTraverse/">二叉树的先序遍历</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/29/elasticsearch-mapping/">Elasticsearch Mapping 学习</a></li></ul></div><div class="widget"><div class="widget-title"> 友情链接</div><ul class="links-list"><li class="links-list-item"><a href="http://www.example.com" title="标题" target="_blank">标题</a></li></ul></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">任春晓的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a> Theme<a target="_blank" href="https://github.com/7ye/maupassant-hexo"> Maupassant.</a></div><a id="back_to_top" href="javascript:void(0)" class="back_to_top"><span>△</span></a><script type="text/javascript" src="/js/totop.js?v=0.0.1"></script><link rel="stylesheet" href="/css/jquery.fancybox.css"><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1"></script><script>function auto_code_fit(){
  if($(".highlight").length != 0){
    var pc_width = $(".post-content").width();
    $(".highlight .code").find("pre").width((pc_width-70)+"px");
  }
}
window.onresize = function(){
  auto_code_fit();
}
auto_code_fit();</script></div></body>